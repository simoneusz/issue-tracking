<h1><%= @issue.new_record? ? "New Issue" : "Edit Issue" %></h1>

<div class="card mb-4">
  <div class="card-body">
    <%= form_with model: [@project, @issue], local: true do |f| %>
      <div class="mb-3">
        <%= f.label :title, "Title" %>
        <%= f.text_field :title, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= f.label :description, "Description" %>
        <%= f.text_area :description, rows: 5, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= f.label :status, "Status" %>
        <%= f.select :status, ["Active", "On hold", "Resolved", "Closed"], {}, class: "form-select" %>
      </div>

      <div class="d-flex justify-content-between">
        <div>
          <%= link_to "Cancel", project_path(@project), class: "btn btn-secondary" %>
          <%= f.submit "Save", class: "btn btn-primary" %>
        </div>

        <% if !@issue.new_record? && @issue.user == current_user %>
          <%= button_to "Delete Issue", project_issue_path(@project, @issue), method: :delete,
                        data: { confirm: "Are you sure?" }, class: "btn btn-danger" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<div class="mb-4">
  <p><strong>Issue number:</strong> <%= @issue.id || "New" %></p>
  <p><strong>Assigned to:</strong> <%= @issue.assignee&.email if @issue.user %></p>
  <p><strong>Creation date:</strong> <%= @issue.created_at&.strftime("%Y-%m-%d") %></p>
</div>

<h3>Comments</h3>
<%= render @issue.comments %>

<%= render "comments/form", issue: @issue %>
